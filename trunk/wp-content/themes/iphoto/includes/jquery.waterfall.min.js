﻿/**
 * @name jQuery waterfall Plugin
 * @version 1.0.6
 * @create 2012.1.30
 * @lastmodified 2012.2.11
 * @description Based on jQuery 1.4+
 * @author MuFeng (http://mufeng.me)
 * @url http://mufeng.me/waterfall.html
 **/
~function(b){var e=[],d=0,c=function(f,g){this.options=f;this.element=b(g);this.init()};c.prototype={init:function(){this.initArg();this.reSize();this.layout(this.getBricks(this.element))},getBricks:function(g){var f=this.options.itemSelector;return $bricks=!f?g.children().not(".waterfall"):g.filter(f).not(".waterfall").add(g.find(f))},getSize:function(){var l=this.getBricks(this.element)[0],j=b(l),m=this.options.columnCount,f=this.options.columnWidth,k=[],i=j.outerWidth(true),g=b(window).width()-20,o=!f?i:f,h=!m?parseInt(g/o):m;return k.concat(o,h)},initArg:function(){if(!d){var f,h=this.getSize(),g=h[1];for(f=0;f<g;f++){e[f]=0}d=1}},reSize:function(){this.element.css("position","relative");if(this.options.isResizable){var h=this.getSize(),g=h[1],f=h[0];this.element.css({width:g*f})}},layout:function(p){var l=0,q=this.element,f=p.length,h=this.options.isAnimated,o=this.options.Duration,g=this.options.Easing,u=this.options.endFn,m=this.getSize(),r=m[0],s;p.css("display","none");k();function k(){if(l<f){var t=p[l],i=b(t),n=j(e),w=Math.max.apply(Math,e);q.height(w);i.addClass("waterfall");var v=i.outerHeight(true);!h?(i.css({display:"block",position:"absolute",left:n*r,top:e[n]})):(i.css({display:"block",position:"absolute",left:0,top:w}).stop().animate({left:n*r,top:e[n]},{Duration:o,Easing:g}));e[n]+=v;l++;s=setTimeout(k,10)}else{if(l>=f){clearTimeout(s);s=null;var w=Math.max.apply(Math,e);q.height(w);if(typeof u=="function"){u.call(p)}}}}function j(n){var t,v=0,i=n[0],w=n.length;for(t=1;t<w;t++){if(n[t]<i){i=n[t];v=t}}return v}}};b.waterfall=function(f,g){f=b.extend({isResizable:false,isAnimated:false,isAppend:false,Duration:500,Easing:"swing",endFn:function(){}},f);b.data(g,"waterfall",new c(f,g));return g};b.fn.waterfall=function(f){return b.waterfall(f,this)};function a(f){console.log({}.toString.call(f)+" | "+f)}}(jQuery);